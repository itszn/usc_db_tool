(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.challenge_app=challenge_app;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _util=require("./util.js");function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var sha1=require("js-sha1");function challenge_app(){return _challenge_app.apply(this,arguments)}function _challenge_app(){_challenge_app=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee13(){var get_index,challenge,add_chart,_add_chart,reqs,add_req,ask_for_req,_ask_for_req;return _regenerator["default"].wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_ask_for_req=function _ask_for_req3(){_ask_for_req=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee12(cur,override,el){var opts,_iterator4,_step4,_loop2,_ret2;return _regenerator["default"].wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:opts=[];_iterator4=_createForOfIteratorHelper(reqs);_context12.prev=2;_loop2=function _loop2(){var r=_step4.value;var req=r;if(req.id in cur)return"continue";if(override&&r.overrideable===false)return"continue";if(r.isDefault){if(!override)return"continue"}if(r.onlyWhen){var good=false;var _iterator5=_createForOfIteratorHelper(r.onlyWhen),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var dep=_step5.value;if(dep in cur&&cur[dep].val){good=true;break}}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}if(!good)return"continue"}if(r.notWhen){var _good=true;var _iterator6=_createForOfIteratorHelper(r.notWhen),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _dep=_step6.value;if(_dep in cur&&cur[_dep].val){_good=false;break}}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}if(!_good)return"continue"}var title=override&&req.otxt?req.otxt:req.txt;opts.push({title:title,f:function(){var _f3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee11(resolve){var val;return _regenerator["default"].wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:val=req.val;if(!(val===undefined)){_context11.next=17;break}val=true;if(!(req.type==="int")){_context11.next=11;break}_context11.t0=parseInt;_context11.next=7;return(0,_util.get_input)("Enter value","Enter value for <code>".concat(title,"</code>"),"","",true);case 7:_context11.t1=_context11.sent;val=(0,_context11.t0)(_context11.t1);_context11.next=17;break;case 11:if(!(req.type==="float")){_context11.next=17;break}_context11.t2=parseFloat;_context11.next=15;return(0,_util.get_input)("Enter value","Enter value for <code>".concat(title,"</code>"),"","",true);case 15:_context11.t3=_context11.sent;val=(0,_context11.t2)(_context11.t3);case 17:add_req(cur,req,val,override,el);resolve();case 19:case"end":return _context11.stop()}}},_callee11)}));function f(_x11){return _f3.apply(this,arguments)}return f}()})};_iterator4.s();case 5:if((_step4=_iterator4.n()).done){_context12.next=11;break}_ret2=_loop2();if(!(_ret2==="continue")){_context12.next=9;break}return _context12.abrupt("continue",9);case 9:_context12.next=5;break;case 11:_context12.next=16;break;case 13:_context12.prev=13;_context12.t0=_context12["catch"](2);_iterator4.e(_context12.t0);case 16:_context12.prev=16;_iterator4.f();return _context12.finish(16);case 19:(0,_util.modal_button_list)("Select Option To Add","Select option to add to ".concat(override?"this chart":"this challenge",":"),opts);case 20:case"end":return _context12.stop()}}},_callee12,null,[[2,13,16,19]])}));return _ask_for_req.apply(this,arguments)};ask_for_req=function _ask_for_req2(_x5,_x6,_x7){return _ask_for_req.apply(this,arguments)};add_req=function _add_req(cur,req_,val,override,el){cur[req_.id]={val:val,req:req_};var rl=el.find(".req-list");rl.empty();var _iterator=_createForOfIteratorHelper(reqs),_step;try{var _loop=function _loop(){var req=_step.value;if(!(req.id in cur))return"continue";if(req.val!==undefined){if(cur[req.id].val!==req.val)return"continue"}var c=el.find(".new-req").clone();c.removeClass("hidden");c.removeClass("new-req");var cur_req=req;c.find(".remove-req").click(function(){delete cur[cur_req.id];c.remove();console.log(cur)});var text=override&&req.otxt?req.otxt:req.txt;var ftext=override&&req.otxt?req.oftxt:req.ftxt;if(ftext){text=ftext.replace("{0}",cur[req.id].val)}c.find(".req-text").text(text);rl.append(c)};for(_iterator.s();!(_step=_iterator.n()).done;){var _ret=_loop();if(_ret==="continue")continue}}catch(err){_iterator.e(err)}finally{_iterator.f()}};_add_chart=function _add_chart3(){_add_chart=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee10(ident,title,level,meta){var c;return _regenerator["default"].wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:c=$("#new-chart").clone();c.insertBefore($("#add-chart"));c.find(".chart-title").text("".concat(title," [").concat(level,"]"));c.find(".chart-add-req").click((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee8(){var chart;return _regenerator["default"].wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:chart=challenge.charts[get_index(c)-1];ask_for_req(chart.reqs,true,c);case 2:case"end":return _context8.stop()}}},_callee8)})));c.find(".chart-remove-chart").click(function(){if(!confirm("Are you sure you want to remove this chart?"))return;var ind=get_index(c)-1;challenge.charts.splice(ind,1);c.remove()});if((0,_typeof2["default"])(ident)==="object"){c.find(".chart-ident").text("Manual")}else{c.find(".chart-ident").text(ident)}c.find(".chart-add-req").click((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee9(){var chart;return _regenerator["default"].wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:chart=challenge.charts[get_index(c)-1];console.log(chart);case 2:case"end":return _context9.stop()}}},_callee9)})));challenge.charts.push({ident:ident,meta:meta,reqs:{}});c.removeClass("hidden");console.log(get_index(c));case 10:case"end":return _context10.stop()}}},_callee10)}));return _add_chart.apply(this,arguments)};add_chart=function _add_chart2(_x,_x2,_x3,_x4){return _add_chart.apply(this,arguments)};get_index=function _get_index(el){return el.parent().children().index(el)};$("#level").on("change keypress input",function(){console.log(lv);var lv=parseInt($("#level").val());if(isNaN(lv))lv="";else{if(lv<1)lv=1;if(lv>12)lv=12}$("#level").val(lv);if(lv===12)lv="∞";$(".level-value").text(lv)});challenge={charts:[],global:{}};window.challenge=challenge;reqs=[{id:"clear",txt:"Require clear to pass",type:"bool",opt:true,val:true},{id:"excessive_gauge",txt:"Play with excessive gauge",type:"bool",val:true,notWhen:["effective_gauge","permissive_gauge","blastive_gauge","gauge_level"]},{id:"permissive_gauge",txt:"Play with permissive gauge",type:"bool",val:true,notWhen:["effective_gauge","excessive_gauge","blastive_gauge","gauge_level"],alsoSet:{excessive_gauge:false,blastive_gauge:false}},{id:"gauge_level",type:"float",txt:"Play with blastive gauge",ftxt:"Play With blastive gauge {0}★",notWhen:["effective_gauge","excessive_gauge","permissive_gauge"],alsoSet:{blastive_gauge:true,permissive_gauge:false,excessive_gauge:false}},{id:"ars",txt:"Force ARS (gauge fallback)",type:"bool",val:true},{id:"min_average_percentage",type:"int",txt:"Require average clear %",ftxt:"At least {0}% average clear",overrideable:false},{id:"min_percentage",type:"int",txt:"Require clear % per chart",otxt:"Require clear %",ftxt:"{0}% clear per chart",oftxt:"At least {0}% clear"},{id:"min_chain",type:"int",txt:"Require minimum chain",ftxt:"At least {0} chain"},{id:"max_errors",type:"int",txt:"Max number of errors per chart",otxt:"Max number of errors",ftxt:"No more than {0} errors"},{id:"min_overall_errors",type:"int",txt:"Maximum number of errors",ftxt:"{0} errors or less",overrideable:false},{id:"max_nears",type:"int",txt:"Max number of nears per chart",otxt:"Max number of nears",ftxt:"No more than {0} nears"},{id:"min_overall_nears",type:"int",txt:"Maximum number of nears",ftxt:"{0} nears or less",overrideable:false},{id:"min_gauge",type:"int",txt:"Require minimum gauge %",ftxt:"Gauge of at least {0}%",trans:function trans(p){return p/100}},{id:"min_average_gauge",type:"int",txt:"Minimum average gauge %",ftxt:"At least {0}% average gauge",trans:function trans(p){return p/100},overrideable:false},{id:"use_sdvx_complete_percentage",type:"bool",txt:"Use SDVX style completion % for fails",opt:true,overrideable:false},{id:"mirror",type:"bool",txt:"Mirror Mode Enabled",opt:true},{id:"gauge_carry_over",type:"bool",txt:"Gauge carry over",opt:true,overrideable:false},{id:"clear",txt:"Do not require clear to pass",type:"bool",opt:true,val:false},{id:"effective_gauge",txt:"Play with effective gauge",opt:true,dummy:true,default:true,notWhen:["excessive_gauge","permissive_gauge","blastive_gauge","gauge_level"],alsoSet:{excessive_gauge:false,permissive_gauge:false,blastive_gauge:false}},{id:"allow_ars",txt:"Allow player to use ARS (gauge fallback)",type:"bool",val:true,isDefault:true},{id:"allow_ars",txt:"Do Not Allow player to use ARS (gauge fallback)",type:"bool",val:false},{id:"allow_excessive",txt:"Allow player to use excessive gauge",type:"bool",val:true,isDefault:true},{id:"allow_excessive",txt:"Do Not Allow player to use excessive gauge",type:"bool",val:false},{id:"allow_permissive",txt:"Allow player to use permissive gauge",type:"bool",val:true,isDefault:true},{id:"allow_permissive",txt:"Do Not Allow player to use permissive gauge",type:"bool",val:false},{id:"allow_blastive",txt:"Allow player to use blastive gauge",type:"bool",val:true,isDefault:true},{id:"allow_blastive",txt:"Do Not Allow player to use blastive gauge",type:"bool",val:false}];$(".global-add-req").click((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ask_for_req(challenge.global,false,$("#global-reqs"));case 1:case"end":return _context.stop()}}},_callee)})));$("#add-chart").click((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(){var p;return _regenerator["default"].wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:p=(0,_util.modal_button_list)("Add Chart",'There are a few ways to specify charts, select from below:</p>\n\n     <div class="file mt-3" style="width: 100%">\n      <label class="file-label fullwidth">\n        <input id="input-chart" class="file-input" type="file" accept=".ksh">\n        <span class="file-cta has-text-centered fullwidth has-background-white" style="flex-direction: column;">\n          <span class="file-label">Use specific .ksh file hash</span>\n        </span>\n      </label>\n     </div>\n\n     <p class="hidden">',[{title:"Enter chart title and level manually",f:function(){var _f=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(resolve){var name,level;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return(0,_util.get_input)("Add Manual Chart","Enter the chart title:","","Chart Title");case 2:name=_context2.sent;if(!(name===null)){_context2.next=5;break}return _context2.abrupt("return",resolve(null));case 5:_context2.next=7;return(0,_util.get_input)("Add Manual Chart","Enter level of <b>".concat((0,_util.esc)(name),"</b>:"),"","Chart Level",true);case 7:level=_context2.sent;if(!(level===null)){_context2.next=10;break}return _context2.abrupt("return",resolve(null));case 10:add_chart({name:name,level:parseInt(level)},name,level,{title:name,level:level});resolve();case 12:case"end":return _context2.stop()}}},_callee2)}));function f(_x8){return _f.apply(this,arguments)}return f}()},{title:"Enter .ksh path",f:function(){var _f2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(resolve){var name,title,level;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:name="";case 1:if(!true){_context3.next=11;break}_context3.next=4;return(0,_util.get_input)("Add Manual Chart",'Enter the path to chart (including folders after your song directory).<br/><br/>Example:<br/>Chart is at <code>C:\\Users\\amanda\\sdvx\\songs\\SDVX V Vivid Wave\\666\\mxm.ksh</code>,<br/>You would enter "SDVX V Vivid Wave\\666\\mxm.ksh"'+(name===""?"":"<br/><b>Must be a .ksh file</b>"),name,"Chart Path");case 4:name=_context3.sent;if(!(name===null)){_context3.next=7;break}return _context3.abrupt("return",resolve(null));case 7:if(!(name.lastIndexOf(".ksh")===name.length-4)){_context3.next=9;break}return _context3.abrupt("break",11);case 9:_context3.next=1;break;case 11:if(name.indexOf("/")!==-1){title=name.split("/").slice(-2)}else{title=name.split("\\").slice(-2)}console.log(title);level=title[1].slice(0,-4);title=title[0];add_chart(name,title,level,{title:title});resolve();case 17:case"end":return _context3.stop()}}},_callee3)}));function f(_x9){return _f2.apply(this,arguments)}return f}()}],function(){var _ref3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(resolve){return _regenerator["default"].wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:$("#input-chart")[0].addEventListener("change",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){var file,reader;return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:$("#modal").removeClass("is-active");file=this.files[0];reader=new FileReader;reader.onload=function(evt){var data=evt.target.result;var hash=sha1(data);reader.onload=function(evt){var chart_meta={};var lines=evt.target.result.split("\n--",1)[0].split("\n");var _iterator2=_createForOfIteratorHelper(lines),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var l=_step2.value;l=l.replace("\r","");var key=l.split("=",1)[0];var val=l.slice(key.length+1);chart_meta[key]=val}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}console.log(chart_meta);add_chart(hash,chart_meta.title,chart_meta.level,chart_meta);resolve()};reader.readAsText(file)};reader.readAsArrayBuffer(file);case 5:case"end":return _context4.stop()}}},_callee4,this)})));case 1:case"end":return _context5.stop()}}},_callee5)}));return function(_x10){return _ref3.apply(this,arguments)}}());case 1:case"end":return _context6.stop()}}},_callee6)})));$("#download").click((0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee7(){var level,data,_i,_Object$entries,t,_t,id,obj,val,_i2,_Object$entries2,_t2,_t3,_id,_val,_iterator3,_step3,chart,over,_i3,_Object$entries3,_t4,_t5,_id2,_obj,_val2,_i4,_Object$entries4,_t6,_t7,_id3,_val3,file_data,a;return _regenerator["default"].wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!($("#title").val()=="")){_context7.next=3;break}$("#title").focus();return _context7.abrupt("return");case 3:if(!(challenge.charts.length==0)){_context7.next=5;break}return _context7.abrupt("return");case 5:level=parseInt($("#level").val());if(isNaN(level))level=1;data={title:$("#title").val(),level:level,charts:[],global:{},overrides:[]};for(_i=0,_Object$entries=Object.entries(challenge.global);_i<_Object$entries.length;_i++){t=_Object$entries[_i];_t=(0,_slicedToArray2["default"])(t,2),id=_t[0],obj=_t[1];if(!obj.req.dummy){val=obj.val;if(obj.req.trans){val=obj.req.trans(val)}data.global[id]=obj.val}if(obj.req.alsoSet){for(_i2=0,_Object$entries2=Object.entries(obj.req.alsoSet);_i2<_Object$entries2.length;_i2++){_t2=_Object$entries2[_i2];_t3=(0,_slicedToArray2["default"])(_t2,2),_id=_t3[0],_val=_t3[1];data.global[_id]=_val}}}_iterator3=_createForOfIteratorHelper(challenge.charts);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){chart=_step3.value;data.charts.push(chart.ident);over={};for(_i3=0,_Object$entries3=Object.entries(chart.reqs);_i3<_Object$entries3.length;_i3++){_t4=_Object$entries3[_i3];_t5=(0,_slicedToArray2["default"])(_t4,2),_id2=_t5[0],_obj=_t5[1];if(!_obj.req.dummy){_val2=_obj.val;if(_obj.req.trans){_val2=_obj.req.trans(_val2)}over[_id2]=_obj.val}if(_obj.req.alsoSet){for(_i4=0,_Object$entries4=Object.entries(_obj.req.alsoSet);_i4<_Object$entries4.length;_i4++){_t6=_Object$entries4[_i4];_t7=(0,_slicedToArray2["default"])(_t6,2),_id3=_t7[0],_val3=_t7[1];over[_id3]=_val3}}}console.log(over);data.overrides.push(over);console.log(data,data.overrides)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}file_data=JSON.stringify(data,null,2);a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(file_data));a.setAttribute("download",data.title+".chal");document.body.appendChild(a);a.click();document.body.removeChild(a);case 18:case"end":return _context7.stop()}}},_callee7)})));add_req(challenge.global,reqs[0],true,false,$("#global-reqs"));case 14:case"end":return _context13.stop()}}},_callee13)}));return _challenge_app.apply(this,arguments)}},{"./util.js":8,"@babel/runtime/helpers/asyncToGenerator":11,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/helpers/slicedToArray":15,"@babel/runtime/helpers/typeof":16,"@babel/runtime/regenerator":19,"js-sha1":20}],2:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.database_app=database_app;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _sql=require("./sql.js");var _log=require("./log.js");var _util=require("./util.js");function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function database_app(){$("html").css("overflowY","hidden");$("#log").parent().prepend($("#errormsg"));$(".column.is-3").prepend($("#pagetitle").css("textAlign","center"));var running=false;$("#btn-remove-col").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var collections,body,_iterator,_step,f,res,ops,deleted,i,o,old_name;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!_sql.has_database||running)){_context.next=2;break}return _context.abrupt("return");case 2:running=true;_context.next=5;return(0,_sql.query)("SELECT DISTINCT collection from Collections").then(_sql.sql_all);case 5:collections=_context.sent;if(!(collections.length===0)){_context.next=10;break}(0,_log.log)("No collections found...");running=false;return _context.abrupt("return");case 10:body="";_iterator=_createForOfIteratorHelper(collections);try{for(_iterator.s();!(_step=_iterator.n()).done;){f=_step.value;body+='\n<div class="field">\n<label class="checkbox">\n  <input type="checkbox">\n  '.concat((0,_util.esc)(f[0]),"\n</label>\n</div>")}}catch(err){_iterator.e(err)}finally{_iterator.f()}_context.next=15;return(0,_util.modal)("Select Collection To Delete",body);case 15:res=_context.sent;if(!(res===null)){_context.next=19;break}running=false;return _context.abrupt("return");case 19:ops=$("#modal").find("input");deleted=0;i=0;case 22:if(!(i<collections.length)){_context.next=34;break}o=ops.eq(i);if(o[0].checked){_context.next=26;break}return _context.abrupt("continue",31);case 26:old_name=collections[i][0];_context.next=29;return(0,_sql.query)("DELETE FROM Collections WHERE collection=$oldname",{$oldname:old_name}).then(_sql.sql_all);case 29:res=_context.sent;deleted++;case 31:i++;_context.next=22;break;case 34:(0,_log.log)("Deleted ".concat(deleted," collection(s)"));running=false;case 36:case"end":return _context.stop()}}},_callee)}))()["catch"](_log.show_error)});$("#btn-rename-col").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var collections,body,_iterator2,_step2,f,res,ops,old_name,i,o,new_name;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!_sql.has_database||running)){_context2.next=2;break}return _context2.abrupt("return");case 2:running=true;_context2.next=5;return(0,_sql.query)("SELECT DISTINCT collection from Collections").then(_sql.sql_all);case 5:collections=_context2.sent;if(!(collections.length===0)){_context2.next=10;break}(0,_log.log)("No collections found...");running=false;return _context2.abrupt("return");case 10:body="";_iterator2=_createForOfIteratorHelper(collections);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){f=_step2.value;body+='\n<div class="field">\n<label class="radio">\n  <input type="radio">\n  '.concat((0,_util.esc)(f[0]),"\n</label>\n</div>")}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}_context2.next=15;return(0,_util.modal)("Select Collection To Rename",body);case 15:res=_context2.sent;if(!(res===null)){_context2.next=19;break}running=false;return _context2.abrupt("return");case 19:ops=$("#modal").find("input");old_name=null;i=0;case 22:if(!(i<collections.length)){_context2.next=31;break}o=ops.eq(i);if(o[0].checked){_context2.next=26;break}return _context2.abrupt("continue",28);case 26:old_name=collections[i][0];return _context2.abrupt("break",31);case 28:i++;_context2.next=22;break;case 31:if(!(old_name===null)){_context2.next=35;break}(0,_log.log)("No collection selected");running=false;return _context2.abrupt("return");case 35:_context2.next=37;return(0,_util.get_input)("Rename Collection",'Enter the new name for the "'.concat(old_name,'" collection:'),old_name);case 37:new_name=_context2.sent;if(!(new_name===null)){_context2.next=41;break}running=false;return _context2.abrupt("return");case 41:if(!(new_name===old_name)){_context2.next=45;break}(0,_log.log)("New name same as old...");running=false;return _context2.abrupt("return");case 45:(0,_log.log)("Renaming collection '".concat(old_name,"'..."));_context2.next=48;return(0,_sql.query)("UPDATE Collections SET collection=$newname where collection=$oldname",{$oldname:old_name,$newname:new_name}).then(_sql.sql_all);case 48:res=_context2.sent;(0,_log.log)("Collection renamed to '".concat(new_name,"'"));running=false;case 51:case"end":return _context2.stop()}}},_callee2)}))()["catch"](_log.show_error)});$("#btn-stats-folders").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(){var _yield$find_folders,_yield$find_folders2,dirs,base_dir,body,_iterator3,_step3,f,res,ops,where,i,o,spath;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(!_sql.has_database||running)){_context3.next=2;break}return _context3.abrupt("return");case 2:running=true;_context3.next=5;return find_folders();case 5:_yield$find_folders=_context3.sent;_yield$find_folders2=(0,_slicedToArray2["default"])(_yield$find_folders,2);dirs=_yield$find_folders2[0];base_dir=_yield$find_folders2[1];dirs=Array.from(dirs.values());body="";_iterator3=_createForOfIteratorHelper(dirs);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){f=_step3.value;body+='\n<div class="field">\n<label class="checkbox">\n  <input type="checkbox" checked>\n  '.concat((0,_util.esc)(f),"\n</label>\n</div>")}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}_context3.next=15;return(0,_util.modal)("Select Folders To Collect Stats For",body);case 15:res=_context3.sent;if(!(res===null)){_context3.next=19;break}running=false;return _context3.abrupt("return");case 19:ops=$("#modal").find("input");where=[];i=0;case 22:if(!(i<dirs.length)){_context3.next=31;break}o=ops.eq(i);if(o[0].checked){_context3.next=26;break}return _context3.abrupt("continue",28);case 26:spath=base_dir+dirs[i];where.push('path LIKE "'.concat(spath,'%"'));case 28:i++;_context3.next=22;break;case 31:if(!(where.length==0)){_context3.next=35;break}_context3.next=34;return do_stats("");case 34:return _context3.abrupt("return");case 35:where=" AND (".concat(where.join(" OR "),")");_context3.next=38;return do_stats(where);case 38:case"end":return _context3.stop()}}},_callee3)}))()["catch"](_log.show_error)});$("#btn-stats").click(function(){if(!_sql.has_database||running)return;running=true;do_stats()});function do_stats(){var where=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(){var volforce,show_grades,table,body,prog,vol_table,low_best_vol,best_vol,_loop,level,_ret;return _regenerator["default"].wrap(function _callee5$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:running=true;$("#log").empty();(0,_log.log)("Starting stat collection. This may take a few minutes");volforce=$('<div style="white-space: initial;">\n<div style="display: inline-block">\n  <div class="tags has-addons mb-0 mt-3">\n    <span class="tag vf is-dark">0 VF</span>\n    <span class="tag vfclass"></span>\n  </div>\n</div>\n<label class="checkbox">\n  <input type="checkbox" checked>\n  Show Grades \n</label>\n</div>');$("#log").append(volforce);show_grades=true;volforce.find("input").on("change",function(){show_grades=!show_grades;$(".grade-line")[show_grades?"show":"hide"]()});table=$("<table>").html("\n<thead>\n  <th>Level</th>\n  <th>Average</th>\n  <th>Clear Average</th>\n  <th>Best Score</th>\n  <th># Clear</th>\n  <th># Ex</th>\n  <th># UC</th>\n  <th># PUC</th>\n  <th># Not Clear</th>\n</thead>\n<tbody>\n</tbody>");body=table.find("tbody");$("#log").append(table);prog=$('<progress value="0" max="4" style="width:100%"></progress>');$("#log").append($("<div>").append(prog));$("#log").append($("<h3>Top 50 Volforce</h33>"));vol_table=$("<table>").html("\n<thead>\n  <th>VF</th>\n  <th>Score</th>\n  <th>Chart</th>\n</thead>\n<tbody>\n</tbody>\n");$("#log").append(vol_table);low_best_vol=0;best_vol=[];_loop=_regenerator["default"].mark(function _loop(level){var raw_scores,chart_count,scores,charts,best_score,get_chart,_get_chart,_iterator4,_step4,row,_row,hash,name,max_score,raw_misses,_iterator5,_step5,_row2,_row3,_hash,is_uc,_chart,raw_ex,_iterator6,_step6,_row4,_row5,_hash2,is_hc,_chart2,raw_c,_iterator7,_step7,_row6,_row7,_hash3,is_c,_chart3,avg_list,score_list,badges,_i,_arr,b,grades,_i2,_score_list,_score_list$_i,h,s,grade,clear,vol,total_vol,vf_classes,vf_class,_i3,_vf_classes,c,stars,i,avg,clr_avg,not_clear,_i4,_arr2,_b,nums,best_chart,grade_s,_iterator8,_step8,_step8$value,_i5,g,_c2,_body,_iterator9,_step9,_c,chart,tags;return _regenerator["default"].wrap(function _loop$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_get_chart=function _get_chart3(){_get_chart=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(hash){var chart;return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:chart=charts[hash];if(chart){_context4.next=6;break}_context4.next=4;return(0,_sql.query)('SELECT * from Charts where hash="'.concat(hash,'" LIMIT 1')).then(_sql.sql_first);case 4:chart=_context4.sent;charts[hash]=chart;case 6:return _context4.abrupt("return",chart);case 7:case"end":return _context4.stop()}}},_callee4)}));return _get_chart.apply(this,arguments)};get_chart=function _get_chart2(_x){return _get_chart.apply(this,arguments)};prog.attr("value","0");_context5.next=5;return(0,_sql.query)("SELECT hash, title, (SELECT max(s.score) from Scores s where s.chart_hash=hash) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 5:raw_scores=_context5.sent;chart_count=raw_scores.length;scores={};charts={};best_score={score:0,hash:null};_iterator4=_createForOfIteratorHelper(raw_scores);_context5.prev=11;_iterator4.s();case 13:if((_step4=_iterator4.n()).done){_context5.next=25;break}row=_step4.value;_row=(0,_slicedToArray2["default"])(row,3),hash=_row[0],name=_row[1],max_score=_row[2];if(!(max_score===null)){_context5.next=18;break}return _context5.abrupt("continue",23);case 18:if(max_score>best_score.score){best_score={score:max_score,hash:hash}}if(!(hash in scores)){_context5.next=22;break}(0,_log.log)("Duplicate charts found for '".concat(name,"'"));return _context5.abrupt("continue",23);case 22:scores[hash]={score:max_score,badge:max_score===1e7?"puc":"f"};case 23:_context5.next=13;break;case 25:_context5.next=30;break;case 27:_context5.prev=27;_context5.t0=_context5["catch"](11);_iterator4.e(_context5.t0);case 30:_context5.prev=30;_iterator4.f();return _context5.finish(30);case 33:prog.attr("value","1");if(!(Object.keys(scores).length===0)){_context5.next=37;break}body.append($("<tr><td>".concat(level,"</td><td><b>0000</b>000</td><td><b>0000</b>000</td><td><b>0000</b>000</td><td>0</td><td>0</td><td>0</td><td>0</td><td>").concat(chart_count,"</td></tr>")));return _context5.abrupt("return","continue");case 37:_context5.next=39;return(0,_sql.query)("SELECT hash, (SELECT 1 from Scores s where s.chart_hash=hash and s.miss=0 limit 1) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 39:raw_misses=_context5.sent;_iterator5=_createForOfIteratorHelper(raw_misses);_context5.prev=41;_iterator5.s();case 43:if((_step5=_iterator5.n()).done){_context5.next=54;break}_row2=_step5.value;_row3=(0,_slicedToArray2["default"])(_row2,2),_hash=_row3[0],is_uc=_row3[1];if(!(is_uc!==1)){_context5.next=48;break}return _context5.abrupt("continue",52);case 48:_chart=scores[_hash];if(!(_chart.badge!="f")){_context5.next=51;break}return _context5.abrupt("continue",52);case 51:_chart.badge="uc";case 52:_context5.next=43;break;case 54:_context5.next=59;break;case 56:_context5.prev=56;_context5.t1=_context5["catch"](41);_iterator5.e(_context5.t1);case 59:_context5.prev=59;_iterator5.f();return _context5.finish(59);case 62:prog.attr("value","2");raw_ex=void 0;if(!(_sql.db_version>17)){_context5.next=70;break}_context5.next=67;return(0,_sql.query)("SELECT hash, (SELECT 1 from Scores s where s.chart_hash=hash and s.gauge_type=1 and s.gauge>0 limit 1) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 67:raw_ex=_context5.sent;_context5.next=73;break;case 70:_context5.next=72;return(0,_sql.query)("SELECT hash, (SELECT 1 from Scores s where s.chart_hash=hash and s.gameflags&1=1 and s.gauge>0 limit 1) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 72:raw_ex=_context5.sent;case 73:_iterator6=_createForOfIteratorHelper(raw_ex);_context5.prev=74;_iterator6.s();case 76:if((_step6=_iterator6.n()).done){_context5.next=87;break}_row4=_step6.value;_row5=(0,_slicedToArray2["default"])(_row4,2),_hash2=_row5[0],is_hc=_row5[1];if(!(is_hc!==1)){_context5.next=81;break}return _context5.abrupt("continue",85);case 81:_chart2=scores[_hash2];if(!(_chart2.badge!="f")){_context5.next=84;break}return _context5.abrupt("continue",85);case 84:_chart2.badge="hc";case 85:_context5.next=76;break;case 87:_context5.next=92;break;case 89:_context5.prev=89;_context5.t2=_context5["catch"](74);_iterator6.e(_context5.t2);case 92:_context5.prev=92;_iterator6.f();return _context5.finish(92);case 95:prog.attr("value","3");raw_c=void 0;if(!(_sql.db_version>17)){_context5.next=103;break}_context5.next=100;return(0,_sql.query)("SELECT hash, (SELECT 1 from Scores s where s.chart_hash=hash and s.gauge_type=0 and s.gauge>0.7 limit 1) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 100:raw_c=_context5.sent;_context5.next=106;break;case 103:_context5.next=105;return(0,_sql.query)("SELECT hash, (SELECT 1 from Scores s where s.chart_hash=hash and s.gameflags&1=0 and s.gauge>0.7 limit 1) from Charts where level=".concat(level," ").concat(where)).then(_sql.sql_all);case 105:raw_c=_context5.sent;case 106:prog.attr("value","4");_iterator7=_createForOfIteratorHelper(raw_c);_context5.prev=108;_iterator7.s();case 110:if((_step7=_iterator7.n()).done){_context5.next=121;break}_row6=_step7.value;_row7=(0,_slicedToArray2["default"])(_row6,2),_hash3=_row7[0],is_c=_row7[1];if(!(is_c!==1)){_context5.next=115;break}return _context5.abrupt("continue",119);case 115:_chart3=scores[_hash3];if(!(_chart3.badge!="f")){_context5.next=118;break}return _context5.abrupt("continue",119);case 118:_chart3.badge="c";case 119:_context5.next=110;break;case 121:_context5.next=126;break;case 123:_context5.prev=123;_context5.t3=_context5["catch"](108);_iterator7.e(_context5.t3);case 126:_context5.prev=126;_iterator7.f();return _context5.finish(126);case 129:avg_list=function avg_list(l){if(l.length===0)return 0;return l.reduce(function(a,b){return a+b})/l.length};score_list=Object.entries(scores);badges={};for(_i=0,_arr=["c","hc","uc","puc"];_i<_arr.length;_i++){b=_arr[_i];badges[b]=0}grades=new Array(10);grades.fill(0);for(_i2=0,_score_list=score_list;_i2<_score_list.length;_i2++){_score_list$_i=(0,_slicedToArray2["default"])(_score_list[_i2],2),h=_score_list$_i[0],s=_score_list$_i[1];grade=.8;if(s.score>=99e5){grade=1.05;s.grade=0}else if(s.score>=98e5){grade=1.02;s.grade=1}else if(s.score>=97e5){grade=1;s.grade=2}else if(s.score>=95e5){grade=.97;s.grade=3}else if(s.score>=93e5){grade=.94;s.grade=4}else if(s.score>=9e6){grade=.91;s.grade=5}else if(s.score>=87e5){grade=.88;s.grade=6}else if(s.score>=75e5){grade=.85;s.grade=7}else if(s.score>=65e5){grade=.82;s.grade=8}clear={puc:1.1,uc:1.05,hc:1.02,c:1,f:.5}[s.badge];badges[s.badge]++;grades[s.grade]++;vol=level*2*(s.score/1e7)*grade*clear;vol=parseInt(vol*10)/1e3;if(best_vol.length<50||low_best_vol<vol){best_vol.push({vf:vol,score:s,hash:h,level:level});if(best_vol.length>50){best_vol=best_vol.sort(function(a,b){return a.vf-b.vf}).slice(-50);low_best_vol=best_vol[0].vf}}}total_vol=best_vol.reduce(function(a,b){return a+b.vf},0);total_vol=parseInt(total_vol*1e3)/1e3;total_vol=Math.max(0,total_vol);vf_classes=[[0,"Sienna","brown","white",[0,2.5,5,7.5]],[10,"Cobalt","navy","white",[10,10.5,11,11.5]],[12,"Dandelion","#fcc800","black",[12,12.5,13,13.5]],[14,"Cyan","#25b7c0","black",[14,14.25,14.5,14.75]],[15,"Scarlet","#f73562","white",[15,15.25,15.5,15.75]],[16,"Coral","#ff69b4","white",[16,16.25,16.5,16.75]],[17,"Argento","#d5ddef","black",[17,17.25,17.5,17.75]],[18,"Eldora","gold","black",[18,18.25,18.5,18.75]],[19,"Crimson","red","white",[19,19.25,19.5,19.75]],[20,"Imperial","purple","white",[20,21,22,23]]];vf_class=void 0;for(_i3=0,_vf_classes=vf_classes;_i3<_vf_classes.length;_i3++){c=_vf_classes[_i3];if(total_vol>=c[0])vf_class=c}stars=1;if(!Array.isArray(vf_class)||vf_class.length<5){try{console.error(vf_class,(0,_typeof2["default"])(vf_class),Array.isArray(vf_class))}catch(e){}vf_class=[0,"Error","red","white",[0,2.5,5,7.5]]}else{for(i=0;i<vf_class[4].length;i++){if(total_vol>vf_class[4][i])stars=i+1}}volforce.find(".vf").text("".concat(total_vol," VF"));volforce.find(".vfclass").text("".concat(vf_class[1]," ").concat("★".repeat(stars))).css("backgroundColor",vf_class[2]).css("color",vf_class[3]);avg=avg_list(score_list.map(function(_ref5){var _ref6=(0,_slicedToArray2["default"])(_ref5,2),_=_ref6[0],x=_ref6[1];return x.score}));clr_avg=avg_list(score_list.filter(function(_ref7){var _ref8=(0,_slicedToArray2["default"])(_ref7,2),_=_ref8[0],x=_ref8[1];return x.badge!=="f"}).map(function(_ref9){var _ref10=(0,_slicedToArray2["default"])(_ref9,2),_=_ref10[0],x=_ref10[1];return x.score}));not_clear=chart_count;for(_i4=0,_arr2=["c","hc","uc","puc"];_i4<_arr2.length;_i4++){_b=_arr2[_i4];not_clear-=badges[_b]}nums=function nums(n){n=parseInt(n);if(n===1e7)return"<b>10000</b>000";n=n.toString();n="0".repeat(7-n.length)+n;return"<b>".concat(n.slice(0,4),"</b>").concat(n.slice(4))};_context5.next=153;return get_chart(best_score.hash);case 153:best_chart=_context5.sent;body.append($("\n<tr>\n  <td>".concat(level,"</td>\n  <td>").concat(nums(avg),"</td>\n  <td>").concat(nums(clr_avg),'</td>\n  <td title="').concat(best_chart?best_chart[1]:"",'">').concat(nums(best_score.score),"</td>\n  <td>").concat(badges.c,"</td>\n  <td>").concat(badges.hc,"</td>\n  <td>").concat(badges.uc,"</td>\n  <td>").concat(badges.puc,"</td>\n  <td>").concat(not_clear,"</td>\n</tr>")));grade_s="";_iterator8=_createForOfIteratorHelper(["S","AAA+","AAA","AA+","AA","A+","A"].entries());_context5.prev=157;_iterator8.s();case 159:if((_step8=_iterator8.n()).done){_context5.next=168;break}_step8$value=(0,_slicedToArray2["default"])(_step8.value,2),_i5=_step8$value[0],g=_step8$value[1];if(!(grades[_i5]===0)){_context5.next=163;break}return _context5.abrupt("continue",166);case 163:_c2="danger";if(_i5<1)_c2="success";else if(_i5<3)_c2="primary";else if(_i5<5)_c2="info";else if(_i5<7)_c2="warning";grade_s+='\n<div class="control"><div class="tags has-addons">\n  <span class="tag is-'.concat(_c2,'">').concat(g,'</span>\n  <span class="tag is-dark">').concat(grades[_i5],"</span>\n</div></div>");case 166:_context5.next=159;break;case 168:_context5.next=173;break;case 170:_context5.prev=170;_context5.t4=_context5["catch"](157);_iterator8.e(_context5.t4);case 173:_context5.prev=173;_iterator8.f();return _context5.finish(173);case 176:if(grade_s!==""){body.append($('\n<tr class="grade-line" style="white-space: initial;'.concat(show_grades?"":"display:none",'">\n  <td></td>\n  <td colspan="8">\n  <div class="field is-grouped is-grouped-multiline">\n    ').concat(grade_s,"\n  </div>\n  </td>\n</td>\n      ")))}_body=vol_table.find("tbody");_body.empty();best_vol.sort(function(a,b){if(a.vf==b.vf)return b.score.score-a.score.score;return b.vf-a.vf});_iterator9=_createForOfIteratorHelper(best_vol);_context5.prev=181;_iterator9.s();case 183:if((_step9=_iterator9.n()).done){_context5.next=193;break}_c=_step9.value;_context5.next=187;return get_chart(_c.hash);case 187:chart=_context5.sent;tags="";if(_c.score.badge==="puc"){tags+=' <span class="tag is-success">PUC</span>'}else if(_c.score.badge==="uc"){tags+=' <span class="tag is-info">UC</span>'}else if(_c.score.badge==="hc"){tags+=' <span class="tag is-danger">EX</span>'}_body.append($('\n<tr style="white-space: initial;">\n  <td>'.concat(_c.vf.toFixed(3),"</td>\n  <td>").concat(_c.score.score).concat(tags,"</td>\n  <td>").concat(chart[1]," [").concat(_c.level,"]</td>\n</tr>")));case 191:_context5.next=183;break;case 193:_context5.next=198;break;case 195:_context5.prev=195;_context5.t5=_context5["catch"](181);_iterator9.e(_context5.t5);case 198:_context5.prev=198;_iterator9.f();return _context5.finish(198);case 201:case"end":return _context5.stop()}}},_loop,null,[[11,27,30,33],[41,56,59,62],[74,89,92,95],[108,123,126,129],[157,170,173,176],[181,195,198,201]])});level=20;case 19:if(!(level>=10)){_context6.next=27;break}return _context6.delegateYield(_loop(level),"t0",21);case 21:_ret=_context6.t0;if(!(_ret==="continue")){_context6.next=24;break}return _context6.abrupt("continue",24);case 24:level--;_context6.next=19;break;case 27:prog.remove();running=false;case 29:case"end":return _context6.stop()}}},_callee5)}))()["catch"](_log.show_error)}$("#btn-dump").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(){return _regenerator["default"].wrap(function _callee6$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!(!_sql.has_database||running)){_context7.next=2;break}return _context7.abrupt("return");case 2:running=true;_context7.next=5;return(0,_sql.query)("SELECT path from Charts limit 20").then(_sql.sql_all).then(function(res){(0,_log.log)("Path of first 20 charts:");var _iterator10=_createForOfIteratorHelper(res),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var r=_step10.value;(0,_log.log)(r)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}});case 5:_context7.next=7;return(0,_sql.query)("SELECT path from Folders limit 20").then(_sql.sql_all).then(function(res){(0,_log.log)("Path of first 20 folders:");var _iterator11=_createForOfIteratorHelper(res),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var r=_step11.value;(0,_log.log)(r)}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}});case 7:running=false;case 8:case"end":return _context7.stop()}}},_callee6)}))()["catch"](_log.show_error)});function find_folders(_x2){return _find_folders.apply(this,arguments)}function _find_folders(){_find_folders=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee10(all_rows){var _yield$find_base_path3,_yield$find_base_path4,base_dir,sep,dirs,_iterator14,_step14,row,path;return _regenerator["default"].wrap(function _callee10$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(!(all_rows===undefined)){_context11.next=4;break}_context11.next=3;return(0,_sql.query)("SELECT rowid, path, folderid from Charts").then(_sql.sql_all);case 3:all_rows=_context11.sent;case 4:_context11.next=6;return find_base_path(all_rows);case 6:_yield$find_base_path3=_context11.sent;_yield$find_base_path4=(0,_slicedToArray2["default"])(_yield$find_base_path3,2);base_dir=_yield$find_base_path4[0];sep=_yield$find_base_path4[1];base_dir+=sep;(0,_log.log)("Base dir is ".concat(base_dir));dirs=new Set;_iterator14=_createForOfIteratorHelper(all_rows);try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){row=_step14.value;path=row[1];path=path.slice(base_dir.length);path=path.split(sep)[0];dirs.add(path)}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}return _context11.abrupt("return",[dirs,base_dir]);case 16:case"end":return _context11.stop()}}},_callee10)}));return _find_folders.apply(this,arguments)}function find_base_path(_x3){return _find_base_path.apply(this,arguments)}function _find_base_path(){_find_base_path=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee11(all_rows){var possible_path,sep,_iterator15,_step15,row,path,i;return _regenerator["default"].wrap(function _callee11$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:if(!(all_rows===undefined)){_context12.next=4;break}_context12.next=3;return(0,_sql.query)("SELECT rowid, path, folderid from Charts").then(_sql.sql_all);case 3:all_rows=_context12.sent;case 4:possible_path=[];sep=all_rows[0][1][0]==="/"?"/":"\\";_iterator15=_createForOfIteratorHelper(all_rows);_context12.prev=7;_iterator15.s();case 9:if((_step15=_iterator15.n()).done){_context12.next=27;break}row=_step15.value;path=row[1].split(sep);if(!(possible_path.length===0)){_context12.next=15;break}possible_path=path;return _context12.abrupt("continue",25);case 15:i=0;case 16:if(!(i<path.length)){_context12.next=25;break}if(!(i>=possible_path.length)){_context12.next=19;break}return _context12.abrupt("break",25);case 19:if(!(path[i]!==possible_path[i])){_context12.next=22;break}possible_path=path.slice(0,i);return _context12.abrupt("break",25);case 22:i++;_context12.next=16;break;case 25:_context12.next=9;break;case 27:_context12.next=32;break;case 29:_context12.prev=29;_context12.t0=_context12["catch"](7);_iterator15.e(_context12.t0);case 32:_context12.prev=32;_iterator15.f();return _context12.finish(32);case 35:return _context12.abrupt("return",[possible_path.join(sep),sep]);case 36:case"end":return _context12.stop()}}},_callee11,null,[[7,29,32,35]])}));return _find_base_path.apply(this,arguments)}$("#btn-paths").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee8(){var all_rows,_yield$find_base_path,_yield$find_base_path2,old_path,sep,new_path,charts_to_flush,flush_charts,update_count,folder_updates,_iterator13,_step13,row,_row8,id,path,fid,updated_path,folder_path,_i6,_Object$entries,f;return _regenerator["default"].wrap(function _callee8$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(!(!_sql.has_database||running)){_context9.next=2;break}return _context9.abrupt("return");case 2:running=true;(0,_log.log)("Finding main song folder");_context9.next=6;return(0,_sql.query)("SELECT rowid, path, folderid from Charts").then(_sql.sql_all);case 6:all_rows=_context9.sent;_context9.next=9;return find_base_path(all_rows);case 9:_yield$find_base_path=_context9.sent;_yield$find_base_path2=(0,_slicedToArray2["default"])(_yield$find_base_path,2);old_path=_yield$find_base_path2[0];sep=_yield$find_base_path2[1];_context9.next=15;return(0,_util.get_input)("Original Song Directory Path","This is our guess of your original song folder, modify it if not correct:",old_path);case 15:old_path=_context9.sent;if(!(old_path===null)){_context9.next=19;break}running=false;return _context9.abrupt("return");case 19:if(old_path[old_path.length-1]!=sep)old_path+=sep;(0,_log.log)("Old song path is ".concat(old_path));_context9.next=23;return(0,_util.get_input)("New Song Directory Path","Enter the new absolute song folder path you want to use:",old_path);case 23:new_path=_context9.sent;if(!(new_path===null)){_context9.next=27;break}running=false;return _context9.abrupt("return");case 27:if(new_path[new_path.length-1]!=sep)new_path+=sep;(0,_log.log)("New song path is ".concat(new_path));(0,_log.log)("Updating chart paths...");charts_to_flush=[];flush_charts=function(){var _ref13=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee7(table){var force,ps,q,or,_iterator12,_step12,c,_c3,id,path,_args8=arguments;return _regenerator["default"].wrap(function _callee7$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:force=_args8.length>1&&_args8[1]!==undefined?_args8[1]:false;if(!(charts_to_flush.length===0)){_context8.next=3;break}return _context8.abrupt("return");case 3:ps={};q="UPDATE ".concat(table," SET path = (case ");or="";_iterator12=_createForOfIteratorHelper(charts_to_flush);try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){c=_step12.value;_c3=(0,_slicedToArray2["default"])(c,2),id=_c3[0],path=_c3[1];q+="when rowid=".concat(id," then $path").concat(id," ");or+="or rowid=".concat(id," ");ps["$path".concat(id)]=path}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}q+="end) where ".concat(or.slice(3));charts_to_flush.length=0;_context8.next=12;return(0,_sql.query)(q,ps);case 12:case"end":return _context8.stop()}}},_callee7)}));return function flush_charts(_x4){return _ref13.apply(this,arguments)}}();update_count=0;folder_updates={};_iterator13=_createForOfIteratorHelper(all_rows);_context9.prev=35;_iterator13.s();case 37:if((_step13=_iterator13.n()).done){_context9.next=49;break}row=_step13.value;_row8=(0,_slicedToArray2["default"])(row,3),id=_row8[0],path=_row8[1],fid=_row8[2];if(path.startsWith(old_path)){_context9.next=42;break}return _context9.abrupt("continue",47);case 42:updated_path=new_path+path.slice(old_path.length);if(!(fid in folder_updates)){folder_path=updated_path.split(sep).slice(0,-1).join(sep);folder_updates[fid]=folder_path}update_count++;charts_to_flush.push([id,updated_path]);if(charts_to_flush.length>=100){flush_charts("Charts")}case 47:_context9.next=37;break;case 49:_context9.next=54;break;case 51:_context9.prev=51;_context9.t0=_context9["catch"](35);_iterator13.e(_context9.t0);case 54:_context9.prev=54;_iterator13.f();return _context9.finish(54);case 57:flush_charts("Charts");(0,_log.log)("Done updating charts with new path. Updated path on ".concat(update_count," charts"));update_count=0;for(_i6=0,_Object$entries=Object.entries(folder_updates);_i6<_Object$entries.length;_i6++){f=_Object$entries[_i6];charts_to_flush.push(f);update_count++;if(charts_to_flush.length>=100){flush_charts("Folders")}}flush_charts("Folders");(0,_log.log)("Done updating folders with new path. Updated path on ".concat(update_count," folders"));running=false;case 64:case"end":return _context9.stop()}}},_callee8,null,[[35,51,54,57]])}))()["catch"](_log.show_error)});$("#btn-download").click(function(){(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee9(){return _regenerator["default"].wrap(function _callee9$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(!(!_sql.has_database||running)){_context10.next=2;break}return _context10.abrupt("return");case 2:running=true;(0,_sql.download)();case 4:case"end":return _context10.stop()}}},_callee9)}))()["catch"](_log.show_error)})}},{"./log.js":3,"./sql.js":7,"./util.js":8,"@babel/runtime/helpers/asyncToGenerator":11,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/helpers/slicedToArray":15,"@babel/runtime/helpers/typeof":16,"@babel/runtime/regenerator":19}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.log=log;exports.log_h=log_h;exports.show_error=show_error;exports.clear_error=clear_error;function log(msg){$("#log").append(msg+"\n")}function log_h(msg){$("#log").append($(msg+"<br/>"))}function show_error(msg){$("#errormsg").text(msg).show();throw msg}function clear_error(){$("#errormsg").hide()}},{}],4:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _sql=require("./sql.js");var _log=require("./log.js");var _util=require("./util.js");var _database_app=require("./database_app.js");var _challenge_app=require("./challenge_app.js");var _replay_app=require("./replay_app.js");var _skin_fix_app=require("./skin_fix_app.js");function activate_app(name){var e=$("#".concat(name));e.insertBefore(e.parent());e.show();$("#apps").remove();$("#app-select").remove()}function main(){{var inputElement=document.getElementById("database");var activate=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var file;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:file=this.files[0];_context.next=3;return(0,_sql.start_sql)(file);case 3:activate_app("database-app");$("#pagetitle").text("USC Database Tool");(0,_database_app.database_app)();case 6:case"end":return _context.stop()}}},_callee,this)}));return function activate(){return _ref.apply(this,arguments)}}();if(location.hash=="#database")return activate();inputElement.addEventListener("change",activate,false)}{var _activate=function(){var _ref2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:activate_app("challenge-app");$("#pagetitle").text("USC Challenge Creator");(0,_challenge_app.challenge_app)();case 3:case"end":return _context2.stop()}}},_callee2)}));return function _activate(){return _ref2.apply(this,arguments)}}();if(location.hash=="#challenge")_activate();$("#newchal").click(_activate)}{var _activate2=function(){var _ref3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(){return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:activate_app("skin-app");$("#pagetitle").text("USC Outdated Skin Fixer");(0,_skin_fix_app.skin_app)();case 3:case"end":return _context3.stop()}}},_callee3)}));return function _activate2(){return _ref3.apply(this,arguments)}}();if(location.hash.split("#")[1]=="fixskin")return _activate2();$("#fixskin").click(_activate2)}{var _inputElement=document.getElementById("replay");var _activate3=function(){var _ref4=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){var file;return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:file=this.files[0];activate_app("replay-app");$("#pagetitle").text("USC Replay Tool");(0,_replay_app.replay_app)(file);case 4:case"end":return _context4.stop()}}},_callee4,this)}));return function _activate3(){return _ref4.apply(this,arguments)}}();if(location.hash=="#replay")return _activate3();_inputElement.addEventListener("change",_activate3,false)}}main()},{"./challenge_app.js":1,"./database_app.js":2,"./log.js":3,"./replay_app.js":5,"./skin_fix_app.js":6,"./sql.js":7,"./util.js":8,"@babel/runtime/helpers/asyncToGenerator":11,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/regenerator":19}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.replay_app=replay_app;var _log=require("./log.js");var _util=require("./util.js");function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function replay_app(file){console.log(file);var reader=new FileReader;reader.onload=function(evt){var db=evt.target.result;init(db)};reader.readAsArrayBuffer(file);var lanes=new Array(8);var stats=new Array(8);for(var i=0;i<8;i++){stats[i]=[]}var lane_map=[1,2,5,6,3,4,0,7];var lane_names=["Blue Laser","Button A","Button B","Left FX","Right FX","Button C","Button D","Red Laser"];var end_time=0;var near_window=92;var crit_window=46;function draw_stats(){var scale=1e3/100;var _loop=function _loop(_i){lanes[_i].css("height","".concat(end_time/scale,"vh"));var _iterator=_createForOfIteratorHelper(stats[_i]),_step;try{var _loop2=function _loop2(){var s=_step.value;if(s.e===undefined){s.e=$("<div>",{css:{width:"inherit",height:"10px",marginTop:"-5px",position:"absolute",backgroundColor:["red","orange","green"][s.rating]}});lanes[_i].append(s.e);if(s.delta!=0){s.m=$("<div>",{css:{width:"inherit",height:"1px",position:"absolute",backgroundColor:"black"}});lanes[_i].append(s.m)}s.e.mouseover(function(){var nv=near_window/scale;s.r=$("<div>",{css:{height:"".concat(nv,"vh"),marginTop:"-".concat(nv/2,"vh"),backgroundColor:"orange",position:"absolute",width:"inherit",top:"".concat(s.time/scale,"vh")}});var cv=crit_window/scale;s.r.append($("<div>",{css:{height:"".concat(cv,"vh"),marginTop:"-".concat(cv/2,"vh"),backgroundColor:"green",position:"relative",width:"100%",top:"50%"}}));s.e.css("opacity",".001");lanes[_i].prepend(s.r)}).mouseout(function(){s.e.css("opacity","1");s.r.remove()})}var t=(s.time+s.delta)/scale;s.e.css("top","".concat(t,"vh"));if(s.m){var _t=s.time/scale;s.m.css("top","".concat(_t,"vh"))}};for(_iterator.s();!(_step=_iterator.n()).done;){_loop2()}}catch(err){_iterator.e(err)}finally{_iterator.f()}};for(var _i=0;_i<8;_i++){_loop(_i)}}function init(data){console.log(data);for(var _i2=0;_i2<8;_i2++){lanes[_i2]=$("<div/>",{class:"column is-1".concat(_i2==0?" is-offset-2":""),css:{height:"100vh",backgroundColor:"white",border:"solid 2px",padding:"0"}});$("#lanes").append(lanes[_i2])}var _iterator2=_createForOfIteratorHelper(parse_replay(data)),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var s=_step2.value;console.assert(s.lane>=0&&s.lane<8);s.lane=lane_map[s.lane];stats[s.lane].push(s);if(s.time>end_time)end_time=s.time}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}console.log(stats);draw_stats()}function parse_replay(data){var dv=new DataView(data);var off=0;var consume=function consume(size){var v=off;off+=size;return v};var u32=function u32(){return dv.getUint32(consume(4),true)};var i32=function i32(){return dv.getInt32(consume(4),true)};var u16=function u16(){return dv.getUint16(consume(2),true)};var u8=function u8(){return dv.getUint8(consume(1),true)};var i8=function i8(){return dv.getInt8(consume(1),true)};var len=u32();var stats=[];for(var _i3=0;_i3<len;_i3++){stats.push({rating:i8(),lane:i8(),time:(u16(),i32()),delta:i32(),hold:u32(),holdMax:u32()})}crit_window=u32();near_window=u32();return stats}}},{"./log.js":3,"./util.js":8}],6:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.skin_app=skin_app;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _log=require("./log.js");var _util=require("./util.js");var fixes={gauge_fix:function gauge_fix(){return(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var _yield$get_file,_yield$get_file2,txt,fname,did_anything,out;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:location.hash="fixskin#gauge_fix";_context.next=3;return(0,_util.get_file)("Open scripts\\gameplay.lua","We can hopefully fix this by modifying <code>scripts\\gameplay.lua</code><br/>Just to be safe, you should make a copy of the file first","Select scripts\\gameplay.lua",".lua","gameplay.lua",Text);case 3:_yield$get_file=_context.sent;_yield$get_file2=(0,_slicedToArray2["default"])(_yield$get_file,2);txt=_yield$get_file2[0];fname=_yield$get_file2[1];console.log(txt);if(!(txt===null)){_context.next=11;break}location.hash="fixskin";return _context.abrupt("return");case 11:did_anything=false;out=txt.replaceAll(/gameplay\.gauge(?!Type|\.)/gm,function(x,y,z){did_anything=true;return"gameplay.gauge.value"});out=out.replaceAll(/gameplay\.gaugeType/gm,function(x,y,z){did_anything=true;return"gameplay.gauge.type"});if(did_anything){(0,_util.download)(fname,out)}else{(0,_util.modal)("Error Fixing Script","No matching issue found. Your skin probably can't be fixed automaticly, sorry.",false)}case 15:case"end":return _context.stop()}}},_callee)}))()},flags_fix:function flags_fix(){return(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var _yield$get_file3,_yield$get_file4,txt,fname,did_anything,out;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:location.hash="fixskin#flags_fix";_context2.next=3;return(0,_util.get_file)("Open scripts\\result.lua","We can hopefully fix this by modifying <code>scripts\\result.lua</code><br/>Just to be safe, you should make a copy of the file first","Select scripts\\result.lua",".lua","result.lua",Text);case 3:_yield$get_file3=_context2.sent;_yield$get_file4=(0,_slicedToArray2["default"])(_yield$get_file3,2);txt=_yield$get_file4[0];fname=_yield$get_file4[1];if(!(txt===null)){_context2.next=10;break}location.hash="fixskin";return _context2.abrupt("return");case 10:did_anything=false;out=txt.replaceAll(/result.flags\s*&\s*2?/gm,function(){did_anything=true;return"result.mirror"});out=out.replaceAll(/result.flags\s*&\s*3?/gm,function(){did_anything=true;return"result.random"});out=out.replaceAll(/result.flags(\s*&\s*1)?/gm,function(m,op){did_anything=true;return"result.gauge_type"});if(did_anything){(0,_util.download)(fname,out)}else{(0,_util.modal)("Error Fixing Script","No matching issue found. Your skin probably can't be fixed automaticly, sorry.",false)}case 15:case"end":return _context2.stop()}}},_callee2)}))()}};function skin_app(file){if(location.hash.length>0){var f=location.hash.split("#")[2];var fix=fixes[f];if(fix)fix()}else{location.hash="fixskin"}$(".fix").each(function(i,e){e=$(e);var f=e.data("fix");var fix=fixes[f];if(!fix)return;e.click(function(){fix()})})}},{"./log.js":3,"./util.js":8,"@babel/runtime/helpers/asyncToGenerator":11,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/helpers/slicedToArray":15,"@babel/runtime/regenerator":19}],7:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.start_sql=start_sql;exports.query=query;exports.sql_first=sql_first;exports.sql_all=sql_all;exports.download=download;exports.db_version=exports.has_database=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));var _log=require("./log.js");var wasm_supported=function(){try{if((typeof WebAssembly==="undefined"?"undefined":(0,_typeof2["default"])(WebAssembly))==="object"&&typeof WebAssembly.instantiate==="function"){var module=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(module instanceof WebAssembly.Module)return new WebAssembly.Instance(module)instanceof WebAssembly.Instance}}catch(e){}return false}();var worker;var has_database=false;exports.has_database=has_database;window.sql_cbs={};var sqlid=1;function query(sql){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve){var sid=sqlid++;window.sql_cbs[sid]=resolve;worker.postMessage({id:sid,action:"exec",sql:sql,params:params})})}function sql_first(results){if(results===undefined)return null;return results.values[0]}function sql_all(results){if(results===undefined)return[];return results.values}var db_version=null;exports.db_version=db_version;function start_sql(file){return new Promise(function(resolve,reject){if(wasm_supported){worker=new Worker("./lib/worker.sql-wasm.js")}else{(0,_log.log_h)('<font color="red">NOTE: Your browser does not support WASM, this tool will run much slower...</font>');worker=new Worker("./lib/worker.sql-asm.js")}worker.onmessage=function(){worker.onmessage=function(event){var data=event.data;if(data.id in window.sql_cbs){var cb=window.sql_cbs[data.id];delete window.sql_cbs[data.id];if(data.error){(0,_log.show_error)(data.error)}if(data.results){cb(data.results[0])}}};query("SELECT version from Database").then(sql_first).then(function(res){var _res=(0,_slicedToArray2["default"])(res,1),ver=_res[0];if(ver<14||ver>20){(0,_log.show_error)("Database is version ".concat(ver,". This app only supports databases with versions 14-20"));reject("Bad version")}exports.db_version=db_version=ver;exports.has_database=has_database=true;(0,_log.log)("USC Database loaded (version ".concat(ver,")"));(0,_log.clear_error)();resolve()})};var reader=new FileReader;reader.onload=function(evt){var db=evt.target.result;worker.postMessage({id:sqlid++,action:"open",buffer:db})};reader.readAsArrayBuffer(file);worker.onerror=function(e){console.error("Worker error: ",e);(0,_log.show_error)(e)}})}function download(){worker.onmessage=function(event){(0,_log.log)("Exporting the database");var arraybuff=event.data.buffer;var blob=new Blob([arraybuff]);var a=document.createElement("a");document.body.appendChild(a);a.href=window.URL.createObjectURL(blob);a.download="maps_modified.db";a.onclick=function(){setTimeout(function(){window.URL.revokeObjectURL(a.href)},1500)};a.click();(0,_log.log)("Closing Database: refresh to restart");exports.has_database=has_database=false};worker.postMessage({action:"export"})}},{"./log.js":3,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/helpers/slicedToArray":15,"@babel/runtime/helpers/typeof":16}],8:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.esc=esc;exports.modal=modal;exports.get_input=get_input;exports.modal_button_list=modal_button_list;exports.get_file=get_file;exports.download=download;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function esc(data){return $("<div>").text(data).html()}function modal(title,body){var has_cancel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return new Promise(function(resolve){var c=$("#modal").addClass("is-active").find(".modal-content").html('\n<div class="box">\n  <div class="content">\n    <h3 class="is-3">'.concat(esc(title),"</h3>\n    <p>").concat(body,'</p>\n    <button class="button btno is-fullwidth">Ok</button>\n    ').concat(has_cancel?'<button class="button btnc is-fullwidth is-danger">Cancel</button>':"","\n  </div>\n</div>"));c.find(".btno").click(function(x){$("#modal").removeClass("is-active");resolve(true)});c.find(".btnc").click(function(x){$("#modal").removeClass("is-active");resolve(null)})})}function modal_button_list(title,body,buttons,after){var p=new Promise(function(resolve){var c=$("#modal").addClass("is-active").find(".modal-content").html('\n  <div class="box">\n  <div class="content">\n    <h3 class="is-3">'.concat(esc(title),"</h3>\n    <p>").concat(body,'</p>\n    \n    <div class="btn-button-list">\n    </div>\n    <button class="button btnc is-fullwidth is-danger mt-3">Cancel</button>\n  </div>\n  </div>'));var _iterator=_createForOfIteratorHelper(buttons),_step;try{var _loop=function _loop(){var b=_step.value;var be=$('<button class="button is-fullwidth mt-1 '.concat(b["class"]|"",'"></button>')).text(b.title);be.click(function(){$("#modal").removeClass("is-active");b.f(resolve)});c.find(".btn-button-list").append(be)};for(_iterator.s();!(_step=_iterator.n()).done;){_loop()}}catch(err){_iterator.e(err)}finally{_iterator.f()}c.find(".btnc").click(function(x){$("#modal").removeClass("is-active");resolve(null)});if(after)after(resolve,c)})}function get_input(title,body){var val=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var placeholder=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var number=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;return new Promise(function(resolve){var c=$("#modal").addClass("is-active").find(".modal-content").html('\n<div class="box">\n  <div class="content">\n    <h3 class="is-3">'.concat(esc(title),"</h3>\n    <p>").concat(body,'</p>\n    <input class="input" type="').concat(number?"number":"text",'" placeholder="').concat(placeholder,'">\n    <button class="button btno is-fullwidth mt-3">Ok</button>\n    <button class="button btnc is-fullwidth mt-1 is-danger">Cancel</b utton>\n  </div>\n</div>'));c.find(".btno").click(function(x){$("#modal").removeClass("is-active");resolve(c.find("input")[0].value)});c.find(".btnc").click(function(x){$("#modal").removeClass("is-active");resolve(null)});c.find("input")[0].value=val})}function get_file(title,body){var label=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var ext=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var expected_name=arguments.length>4&&arguments[4]!==undefined?arguments[4]:undefined;var type=arguments.length>5&&arguments[5]!==undefined?arguments[5]:ArrayBuffer;return new Promise(function(resolve){var c=$("#modal").addClass("is-active").find(".modal-content").html('\n<div class="box">\n  <div class="content">\n    <h3 class="is-3">'.concat(esc(title),'</h3>\n    <p class="modal-body">').concat(body,'</p>\n    <label class="file-label" style="width: 100%">\n      <input class="file-input" type="file" ').concat(ext?'accept="'.concat(ext,'"'):"",'>\n      <span class="file-cta has-text-centered" style="width: 100%; flex-direction: column;">\n        <span class="file-label">\n          ').concat(label,'\n        </span>\n      </span>\n    </label>\n    <div class="modal-error"></div>\n    <button class="button btno is-fullwidth mt-3" style="display: none">I know what I\'m doing</button>\n    <button class="button btnc is-fullwidth mt-1 is-danger">Cancel</button>\n  </div>\n</div>'));var file=undefined;var read=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(file){var reader;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:reader=new FileReader;reader.onload=function(evt){resolve([evt.target.result,file.name])};reader["readAs"+(type.name||type)](file);case 3:case"end":return _context.stop()}}},_callee)}));return function read(_x){return _ref.apply(this,arguments)}}();c.find(".file-input").on("change",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:file=this.files[0];if(!(file===undefined)){_context2.next=3;break}return _context2.abrupt("return");case 3:c.find(".expected-file-error").remove();if(!(expected_name&&file.name!==expected_name)){_context2.next=8;break}c.find(".btno").show();c.find(".modal-error").append($('<div class="expected-file-error"><strong>Please only select '.concat(expected_name,"</strong></div>")));return _context2.abrupt("return");case 8:$("#modal").removeClass("is-active");read(file);case 10:case"end":return _context2.stop()}}},_callee2,this)})));c.find(".btno").click(function(x){if(file===undefined)return;$("#modal").removeClass("is-active");read(file)});c.find(".btnc").click(function(x){$("#modal").removeClass("is-active");resolve([null,null])})})}function download(name,out){var blob=new Blob([out]);var a=document.createElement("a");document.body.appendChild(a);a.href=window.URL.createObjectURL(blob);a.download=name;a.onclick=function(){setTimeout(function(){window.URL.revokeObjectURL(a.href)},1500)};a.click()}},{"@babel/runtime/helpers/asyncToGenerator":11,"@babel/runtime/helpers/interopRequireDefault":12,"@babel/runtime/regenerator":19}],9:[function(require,module,exports){function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}module.exports=_arrayLikeToArray},{}],10:[function(require,module,exports){function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}module.exports=_arrayWithHoles},{}],11:[function(require,module,exports){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}module.exports=_asyncToGenerator},{}],12:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_interopRequireDefault},{}],13:[function(require,module,exports){function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}module.exports=_iterableToArrayLimit},{}],14:[function(require,module,exports){function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}module.exports=_nonIterableRest},{}],15:[function(require,module,exports){var arrayWithHoles=require("./arrayWithHoles");var iterableToArrayLimit=require("./iterableToArrayLimit");var unsupportedIterableToArray=require("./unsupportedIterableToArray");var nonIterableRest=require("./nonIterableRest");function _slicedToArray(arr,i){return arrayWithHoles(arr)||iterableToArrayLimit(arr,i)||unsupportedIterableToArray(arr,i)||nonIterableRest()}module.exports=_slicedToArray},{"./arrayWithHoles":10,"./iterableToArrayLimit":13,"./nonIterableRest":14,"./unsupportedIterableToArray":17}],16:[function(require,module,exports){function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){module.exports=_typeof=function _typeof(obj){return typeof obj}}else{module.exports=_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}module.exports=_typeof},{}],17:[function(require,module,exports){var arrayLikeToArray=require("./arrayLikeToArray");function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return arrayLikeToArray(o,minLen)}module.exports=_unsupportedIterableToArray},{"./arrayLikeToArray":9}],18:[function(require,module,exports){var runtime=function(exports){"use strict";var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});return obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}exports.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction");function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg)})})}exports.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};exports.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;define(genFun,toStringTagSymbol,"GeneratorFunction")}genFun.prototype=Object.create(Gp);return genFun};exports.awrap=function(arg){return{__await:arg}};function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)})}return PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped;resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this};exports.AsyncIterator=AsyncIterator;exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){if(PromiseImpl===void 0)PromiseImpl=Promise;var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if(context.method==="next"){context.sent=context._sent=context.arg}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg}context.dispatchException(context.arg)}else if(context.method==="return"){context.abrupt("return",context.arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue}return{value:record.arg,done:context.done}}else if(record.type==="throw"){state=GenStateCompleted;context.method="throw";context.arg=record.arg}}}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){context.delegate=null;if(context.method==="throw"){if(delegate.iterator["return"]){context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){return ContinueSentinel}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel}if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc;if(context.method!=="return"){context.method="next";context.arg=undefined}}else{return info}context.delegate=null;return ContinueSentinel}defineIteratorMethods(Gp);define(Gp,toStringTagSymbol,"Generator");Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}exports.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}exports.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){context.method="next";context.arg=undefined}return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel}return this.complete(record)},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}return ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){this.arg=undefined}return ContinueSentinel}};return exports}(typeof module==="object"?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}},{}],19:[function(require,module,exports){module.exports=require("regenerator-runtime")},{"regenerator-runtime":18}],20:[function(require,module,exports){(function(process,global){(function(){(function(){"use strict";var root=typeof window==="object"?window:{};var NODE_JS=!root.JS_SHA1_NO_NODE_JS&&typeof process==="object"&&process.versions&&process.versions.node;if(NODE_JS){root=global}var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&typeof module==="object"&&module.exports;var AMD=typeof define==="function"&&define.amd;var HEX_CHARS="0123456789abcdef".split("");var EXTRA=[-2147483648,8388608,32768,128];var SHIFT=[24,16,8,0];var OUTPUT_TYPES=["hex","array","digest","arrayBuffer"];var blocks=[];var createOutputMethod=function(outputType){return function(message){return new Sha1(true).update(message)[outputType]()}};var createMethod=function(){var method=createOutputMethod("hex");if(NODE_JS){method=nodeWrap(method)}method.create=function(){return new Sha1};method.update=function(message){return method.create().update(message)};for(var i=0;i<OUTPUT_TYPES.length;++i){var type=OUTPUT_TYPES[i];method[type]=createOutputMethod(type)}return method};var nodeWrap=function(method){var crypto=eval("require('crypto')");var Buffer=eval("require('buffer').Buffer");var nodeMethod=function(message){if(typeof message==="string"){return crypto.createHash("sha1").update(message,"utf8").digest("hex")}else if(message.constructor===ArrayBuffer){message=new Uint8Array(message)}else if(message.length===undefined){return method(message)}return crypto.createHash("sha1").update(new Buffer(message)).digest("hex")};return nodeMethod};function Sha1(sharedMemory){if(sharedMemory){blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0;this.blocks=blocks}else{this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}this.h0=1732584193;this.h1=4023233417;this.h2=2562383102;this.h3=271733878;this.h4=3285377520;this.block=this.start=this.bytes=this.hBytes=0;this.finalized=this.hashed=false;this.first=true}Sha1.prototype.update=function(message){if(this.finalized){return}var notString=typeof message!=="string";if(notString&&message.constructor===root.ArrayBuffer){message=new Uint8Array(message)}var code,index=0,i,length=message.length||0,blocks=this.blocks;while(index<length){if(this.hashed){this.hashed=false;blocks[0]=this.block;blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0}if(notString){for(i=this.start;index<length&&i<64;++index){blocks[i>>2]|=message[index]<<SHIFT[i++&3]}}else{for(i=this.start;index<length&&i<64;++index){code=message.charCodeAt(index);if(code<128){blocks[i>>2]|=code<<SHIFT[i++&3]}else if(code<2048){blocks[i>>2]|=(192|code>>6)<<SHIFT[i++&3];blocks[i>>2]|=(128|code&63)<<SHIFT[i++&3]}else if(code<55296||code>=57344){blocks[i>>2]|=(224|code>>12)<<SHIFT[i++&3];blocks[i>>2]|=(128|code>>6&63)<<SHIFT[i++&3];blocks[i>>2]|=(128|code&63)<<SHIFT[i++&3]}else{code=65536+((code&1023)<<10|message.charCodeAt(++index)&1023);blocks[i>>2]|=(240|code>>18)<<SHIFT[i++&3];blocks[i>>2]|=(128|code>>12&63)<<SHIFT[i++&3];blocks[i>>2]|=(128|code>>6&63)<<SHIFT[i++&3];blocks[i>>2]|=(128|code&63)<<SHIFT[i++&3]}}}this.lastByteIndex=i;this.bytes+=i-this.start;if(i>=64){this.block=blocks[16];this.start=i-64;this.hash();this.hashed=true}else{this.start=i}}if(this.bytes>4294967295){this.hBytes+=this.bytes/4294967296<<0;this.bytes=this.bytes%4294967296}return this};Sha1.prototype.finalize=function(){if(this.finalized){return}this.finalized=true;var blocks=this.blocks,i=this.lastByteIndex;blocks[16]=this.block;blocks[i>>2]|=EXTRA[i&3];this.block=blocks[16];if(i>=56){if(!this.hashed){this.hash()}blocks[0]=this.block;blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0}blocks[14]=this.hBytes<<3|this.bytes>>>29;blocks[15]=this.bytes<<3;this.hash()};Sha1.prototype.hash=function(){var a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4;var f,j,t,blocks=this.blocks;for(j=16;j<80;++j){t=blocks[j-3]^blocks[j-8]^blocks[j-14]^blocks[j-16];blocks[j]=t<<1|t>>>31}for(j=0;j<20;j+=5){f=b&c|~b&d;t=a<<5|a>>>27;e=t+f+e+1518500249+blocks[j]<<0;b=b<<30|b>>>2;f=a&b|~a&c;t=e<<5|e>>>27;d=t+f+d+1518500249+blocks[j+1]<<0;a=a<<30|a>>>2;f=e&a|~e&b;t=d<<5|d>>>27;c=t+f+c+1518500249+blocks[j+2]<<0;e=e<<30|e>>>2;f=d&e|~d&a;t=c<<5|c>>>27;b=t+f+b+1518500249+blocks[j+3]<<0;d=d<<30|d>>>2;f=c&d|~c&e;t=b<<5|b>>>27;a=t+f+a+1518500249+blocks[j+4]<<0;c=c<<30|c>>>2}for(;j<40;j+=5){f=b^c^d;t=a<<5|a>>>27;e=t+f+e+1859775393+blocks[j]<<0;b=b<<30|b>>>2;f=a^b^c;t=e<<5|e>>>27;d=t+f+d+1859775393+blocks[j+1]<<0;a=a<<30|a>>>2;f=e^a^b;t=d<<5|d>>>27;c=t+f+c+1859775393+blocks[j+2]<<0;e=e<<30|e>>>2;f=d^e^a;t=c<<5|c>>>27;b=t+f+b+1859775393+blocks[j+3]<<0;d=d<<30|d>>>2;f=c^d^e;t=b<<5|b>>>27;a=t+f+a+1859775393+blocks[j+4]<<0;c=c<<30|c>>>2}for(;j<60;j+=5){f=b&c|b&d|c&d;t=a<<5|a>>>27;e=t+f+e-1894007588+blocks[j]<<0;b=b<<30|b>>>2;f=a&b|a&c|b&c;t=e<<5|e>>>27;d=t+f+d-1894007588+blocks[j+1]<<0;a=a<<30|a>>>2;f=e&a|e&b|a&b;t=d<<5|d>>>27;c=t+f+c-1894007588+blocks[j+2]<<0;e=e<<30|e>>>2;f=d&e|d&a|e&a;t=c<<5|c>>>27;b=t+f+b-1894007588+blocks[j+3]<<0;d=d<<30|d>>>2;f=c&d|c&e|d&e;t=b<<5|b>>>27;a=t+f+a-1894007588+blocks[j+4]<<0;c=c<<30|c>>>2}for(;j<80;j+=5){f=b^c^d;t=a<<5|a>>>27;e=t+f+e-899497514+blocks[j]<<0;b=b<<30|b>>>2;f=a^b^c;t=e<<5|e>>>27;d=t+f+d-899497514+blocks[j+1]<<0;a=a<<30|a>>>2;f=e^a^b;t=d<<5|d>>>27;c=t+f+c-899497514+blocks[j+2]<<0;e=e<<30|e>>>2;f=d^e^a;t=c<<5|c>>>27;b=t+f+b-899497514+blocks[j+3]<<0;d=d<<30|d>>>2;f=c^d^e;t=b<<5|b>>>27;a=t+f+a-899497514+blocks[j+4]<<0;c=c<<30|c>>>2}this.h0=this.h0+a<<0;this.h1=this.h1+b<<0;this.h2=this.h2+c<<0;this.h3=this.h3+d<<0;this.h4=this.h4+e<<0};Sha1.prototype.hex=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return HEX_CHARS[h0>>28&15]+HEX_CHARS[h0>>24&15]+HEX_CHARS[h0>>20&15]+HEX_CHARS[h0>>16&15]+HEX_CHARS[h0>>12&15]+HEX_CHARS[h0>>8&15]+HEX_CHARS[h0>>4&15]+HEX_CHARS[h0&15]+HEX_CHARS[h1>>28&15]+HEX_CHARS[h1>>24&15]+HEX_CHARS[h1>>20&15]+HEX_CHARS[h1>>16&15]+HEX_CHARS[h1>>12&15]+HEX_CHARS[h1>>8&15]+HEX_CHARS[h1>>4&15]+HEX_CHARS[h1&15]+HEX_CHARS[h2>>28&15]+HEX_CHARS[h2>>24&15]+HEX_CHARS[h2>>20&15]+HEX_CHARS[h2>>16&15]+HEX_CHARS[h2>>12&15]+HEX_CHARS[h2>>8&15]+HEX_CHARS[h2>>4&15]+HEX_CHARS[h2&15]+HEX_CHARS[h3>>28&15]+HEX_CHARS[h3>>24&15]+HEX_CHARS[h3>>20&15]+HEX_CHARS[h3>>16&15]+HEX_CHARS[h3>>12&15]+HEX_CHARS[h3>>8&15]+HEX_CHARS[h3>>4&15]+HEX_CHARS[h3&15]+HEX_CHARS[h4>>28&15]+HEX_CHARS[h4>>24&15]+HEX_CHARS[h4>>20&15]+HEX_CHARS[h4>>16&15]+HEX_CHARS[h4>>12&15]+HEX_CHARS[h4>>8&15]+HEX_CHARS[h4>>4&15]+HEX_CHARS[h4&15]};Sha1.prototype.toString=Sha1.prototype.hex;Sha1.prototype.digest=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return[h0>>24&255,h0>>16&255,h0>>8&255,h0&255,h1>>24&255,h1>>16&255,h1>>8&255,h1&255,h2>>24&255,h2>>16&255,h2>>8&255,h2&255,h3>>24&255,h3>>16&255,h3>>8&255,h3&255,h4>>24&255,h4>>16&255,h4>>8&255,h4&255]};Sha1.prototype.array=Sha1.prototype.digest;Sha1.prototype.arrayBuffer=function(){this.finalize();var buffer=new ArrayBuffer(20);var dataView=new DataView(buffer);dataView.setUint32(0,this.h0);dataView.setUint32(4,this.h1);dataView.setUint32(8,this.h2);dataView.setUint32(12,this.h3);dataView.setUint32(16,this.h4);return buffer};var exports=createMethod();if(COMMON_JS){module.exports=exports}else{root.sha1=exports;if(AMD){define(function(){return exports})}}})()}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:21}],21:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}]},{},[4]);
